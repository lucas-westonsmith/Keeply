<div class="list-show-container">
  <% if @list.photo.attached? %>
    <div class="list-image">
      <%= image_tag @list.photo, alt: "List photo" %>
    </div>
  <% end %>

  <div class="list-details container">
    <h1 class="list-title"><%= @list.title %></h1>
    <p class="list-description"><%= @list.description %></p>

    <div class="list-shared">
      <h3>Shared with:</h3>
      <ul>
        <% @list.users.each do |user| %>
          <li><%= user.email %></li>
        <% end %>
      </ul>
    </div>

    <div class="list-actions">
      <%= link_to 'Back to lists', lists_path, class: 'btn btn-secondary' %>
      <%= link_to 'Edit', edit_list_path(@list), class: 'btn btn-primary' %>
      <%= link_to 'Delete', @list, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
    </div>
  </div>

  <div class="list-items container my-5">
    <h2 class="list-items-title">Items in this list</h2>
    <%= link_to 'Add a new item', new_list_item_path(@list), class: 'btn btn-primary add-item-button' %>

    <!-- Section de tri et filtrage -->
    <div class="filter-sort-container">
      <div class="filter-sort-box">
        <h2 class="filter-sort-header">Filter and Sort</h2>
        <form class="filter-sort-form" method="get">
          <!-- Sorting Options -->
          <div class="sort-options">
            <label for="sort">Sort by:</label>
            <select name="sort" id="sort" class="form-select">
              <option value="" <%= params[:sort].blank? ? "selected" : "" %>>Select</option>
              <option value="price_asc" <%= params[:sort] == "price_asc" ? "selected" : "" %>>Price: Low to High</option>
              <option value="price_desc" <%= params[:sort] == "price_desc" ? "selected" : "" %>>Price: High to Low</option>
            </select>
          </div>

          <!-- Filter by Category -->
          <div class="filter-options">
            <label for="category">Category:</label>
            <select name="category" id="category" class="form-select">
              <option value="" <%= params[:category].blank? ? "selected" : "" %>>All Categories</option>
              <% @list.items.distinct.pluck(:category).each do |category| %>
                <option value="<%= category %>" <%= params[:category] == category ? "selected" : "" %>><%= category %></option>
              <% end %>
            </select>
          </div>

          <!-- Filter by Condition -->
          <div class="filter-options">
            <label for="condition">Condition:</label>
            <select name="condition" id="condition" class="form-select">
              <option value="" <%= params[:condition].blank? ? "selected" : "" %>>All Conditions</option>
              <% @list.items.distinct.pluck(:condition).each do |condition| %>
                <option value="<%= condition %>" <%= params[:condition] == condition ? "selected" : "" %>><%= condition.capitalize %></option>
              <% end %>
            </select>
          </div>

          <!-- Buttons -->
          <div class="filter-sort-actions">
            <button type="submit" class="apply-button">Apply</button>
            <%= link_to 'Reset', list_path(@list), class: 'reset-button' %>
          </div>
        </form>
      </div>
    </div>

    <div class="items-list">
      <% @list.items.each do |item| %>
        <div class="item-card">
          <%= link_to item_path(item), class: "item-link" do %>
            <div class="item-image">
              <% if item.photo.attached? %>
                <%= image_tag item.photo, alt: "Item photo" %>
              <% else %>
                <div class="placeholder-image">No Image</div>
              <% end %>
            </div>
            <div class="item-title">
              <h3><%= item.title %></h3>
            </div>
            <div class="item-details">
              <p class="item-price"><strong>Price:</strong> <%= item.price %>â‚¬</p>
              <p class="item-category"><strong>Category:</strong> <%= item.category %></p>
              <p class="item-condition"><strong>Condition:</strong> <%= item.condition.capitalize %></p>
            </div>
          <% end %>
          <div class="item-actions">
            <%= link_to remove_item_from_list_path(@list, item.id), method: :delete, data: { turbo_method: :delete, confirm: 'Are you sure?' }, class: 'btn btn-warning remove-item-button' do %>
              Remove from list
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
