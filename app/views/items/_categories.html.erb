<% categories ||= { specific: [], common: [] } %>

<div class="form-group" data-category-target="categoriesContainer">
  <% if local_assigns[:f] %>
    <%= f.label :category, "Category", class: "form-label", style: "font-weight: bold;" %>
  <% else %>
    <label class="form-label" style="font-weight: bold;">Category</label>
  <% end %>

  <select class="form-select" name="item[category]" id="item_category">
    <!-- ✅ Option vide par défaut -->
    <option value="" <%= @item&.category.blank? ? "selected" : "" %>>Select a category</option>

    <% if categories[:specific].any? %>
      <optgroup label="Specific to selected lists">
        <% categories[:specific].each do |category| %>
          <option value="<%= category %>" <%= @item&.category == category ? "selected" : "" %>><%= category %></option>
        <% end %>
      </optgroup>
    <% end %>

    <% if categories[:common].any? %>
      <optgroup label="Common categories">
        <% categories[:common].each do |category| %>
          <option value="<%= category %>" <%= @item&.category == category ? "selected" : "" %>><%= category %></option>
        <% end %>
      </optgroup>
    <% end %>

    <!-- ✅ Garde "Other category" bien positionné et évite les sélections vides -->
    <option value="other" <%= @item&.category == "other" ? "selected" : "" %>>Other category</option>
  </select>
</div>
